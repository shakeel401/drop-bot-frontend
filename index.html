<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dave Does Water | DropBot</title>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="icon" type="image/png" href="chatbot-icon.png" />
  <style>
    /* Optional: smooth transition when moving input */
    .chat-wrapper {
      transition: all 0.4s ease;
    }
    .chat-layout-active {
      display: flex;
      flex-direction: column;
    }
    .chat-layout-active .chat-window {
      order: 1;
    }
    .chat-layout-active .chat-wrapper {
      order: 2;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="outer-box">
    
    <!-- HEADER -->
    <header id="main-header">
      <h1>Welcome to DaveDoesWater.com!</h1>
      <img src="dropbot-small.png" alt="DropBot Mascot" class="header-logo"/>
    </header>

    <!-- CHAT INPUT (initially above) -->
    <section class="chat-wrapper" id="chat-wrapper">
      <div class="chat-bar">
        <img src="dropbot-small.png" class="input-icon" alt="DropBot"/>
        <input type="text" id="user-input" placeholder="Ask AI Drop Bot!" />
      </div>
      <button id="ask-button" class="send-btn">Ask DropBot</button>
    </section>

    <!-- INTRO TEXT -->
    <section id="intro" class="intro" style="text-align: justify;">
      <p>
        <strong>Meet DropBot – your personal AI water expert.</strong>
      </p>
      <p>
        Water is nature’s universal solvent. As it moves through the earth, it dissolves the minerals it touches. That’s why your tap water can be completely different from someone’s just 10 miles away.
      </p>
      <p>
        Here in the Midwest, limestone dominates the soil, so calcium levels above 7 ppm are common and unavoidable. When calcium-rich water flows through copper pipes, corrosion builds up. Heat that same hard water, and you’ll get lime scale – a serious threat to appliances.
      </p>
      <p>
        The only scientifically proven way to stop hard water damage? Ion Exchange.
      </p>
      <p>
        Dave Bauer is a water expert with over 15 years of experience solving water challenges for industrial, commercial, and residential clients. The AI DropBot on this page combines more than 100 years of collective water treatment expertise—ready to answer your questions and find the right solution for you.
      </p>
      <p>
        We’ll even come to your home, test your water, and provide answers—with no obligation to buy.
      </p>
      <p>
        All Pro Water is the official St. Louis distributor for Hague Water International. We back our systems with a 10-year parts and labor warranty, while Hague offers an industry-leading 25-year manufacturer’s warranty. Proudly made in the USA, Hague systems are built to protect your home, your appliances, and your health for life.
      </p>
      <p>
        <strong>Call today to schedule your free in-home water evaluation.</strong>
      </p>
    </section>


    <!-- CONTACT INFO -->
    <section id="contact-info" class="contact-info">
      <p><strong>Dave Bauer</strong><br/>
      <a href="tel:3143941500">314-394-1500</a><br/>
      <a href="mailto:Dave@ApwStl.com" class="email-btn">Dave@ApwStl.com</a></p>
    </section>

    <!-- SUGGESTED TOPICS -->
    <section id="suggested-box" class="suggested-questions">
      <button>City Water</button>
      <button>Spring Water</button>
      <button>Chlorine</button>
      <button>Well Water</button>
      <button>Purified Water</button>
      <button>Calcium</button>
      <button>Hard Water</button>
      <button>Distilled Water</button>
      <button>Sulfur</button>
      <button>Soft Water</button>
      <button>Alkaline Water</button>
      <button>Bacteria</button>
      <button>Corrosion</button>
      <button>UV Treatment</button>
      <button>Pesticides</button>
      <button>Limescale</button>
      <button>Ion Exchange</button>
      <button>E. Coli</button>
      <button>Soap Scum</button>
      <button>Reverse Osmosis</button>
      <button>Heavy Metals</button>
    </section>

    <!-- CHAT WINDOW -->
    <div class="chat-container" id="chat-container">
      <section class="chat-window" id="chat-window" style="display: none;"></section>
    </div>

    <!-- FOOTER -->
    <footer id="footer">
      <div class="footer-logos">
        <img src="allpro-logo.jpg" alt="All Pro Water Logo" />
        <img src="hague-logo.jpg" alt="Hague Water Logo" />
      </div>
      <div class="footer-contact">
        <p>Dave Bauer – 314-394-1500 – <a href="mailto:Dave@ApwStl.com">Dave@ApwStl.com</a></p>
      </div>
    </footer>
  </div>

  <!-- SCRIPT -->
  <script>
    const input = document.getElementById("user-input");
    const askBtn = document.getElementById("ask-button");
    const chatWindow = document.getElementById("chat-window");
    const buttons = document.querySelectorAll(".suggested-questions button");
    const chatWrapper = document.getElementById("chat-wrapper");
    const chatContainer = document.getElementById("chat-container");

    let hasInteracted = false;
    let thread_id = localStorage.getItem("dropbot_thread_id") || "";

    const scrollToBottom = () => {
      chatWindow.scrollTop = chatWindow.scrollHeight;
    };

    const hideIntro = () => {
      ["main-header", "intro", "contact-info", "suggested-box", "footer"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = "none";
      });
      chatWindow.style.display = "flex";

      // Add welcome message once
      const welcomeMsg = document.createElement("div");
      welcomeMsg.className = "message bot";
      welcomeMsg.innerHTML = "👋 Hi! I’m DropBot — your water knowledge assistant. Ask me anything about water quality, treatment, or solutions!";
      chatWindow.appendChild(welcomeMsg);

      scrollToBottom();
    };


    const moveInputBelowChat = () => {
      // Move chat input below chat window
      chatContainer.style.width = "100%";
      chatContainer.appendChild(chatWrapper);
      document.body.classList.add("chat-layout-active");
    };

    const sendMessage = async () => {
      const query = input.value.trim();
      if (!query) return;

      if (!hasInteracted) {
        hideIntro();
        moveInputBelowChat();
        hasInteracted = true;
      }

      const userMsg = document.createElement("div");
      userMsg.className = "message user";
      userMsg.textContent = query;
      chatWindow.appendChild(userMsg);

      const botMsg = document.createElement("div");
      botMsg.className = "message bot";
      botMsg.innerHTML = "⏳ Thinking...";
      chatWindow.appendChild(botMsg);

      scrollToBottom();
      input.value = "";

      try {
        const formData = new FormData();
        formData.append("query", query);
        formData.append("thread_id", thread_id);

        const res = await fetch("https://shakeel676-drop-bot.hf.space/ask/", {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        thread_id = data.thread_id;
        localStorage.setItem("dropbot_thread_id", thread_id);
        botMsg.innerHTML = marked.parse(data.response || "❌ No response.");
      } catch (err) {
        botMsg.innerHTML = "⚠️ Error contacting DropBot.";
      }

      scrollToBottom();
    };

    askBtn.addEventListener("click", sendMessage);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        input.value = btn.textContent;
        sendMessage();
      });
    });
  </script>
</body>
</html>


