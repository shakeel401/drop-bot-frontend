<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dave Does Water | DropBot</title>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="icon" type="image/png" href="chatbot-icon.png" />
  <style>
    /* Default arrow (down) */
    .suggested-questions button::after {
      content: "";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%) rotate(45deg); /* pointing down */
      border: solid #2e2a85;
      border-width: 0 2px 2px 0;
      padding: 3px;
      transition: transform 0.3s ease, border-color 0.3s ease;
    }

    /* Hover effect */
    .suggested-questions button:hover::after {
      border-color: white;
    }

    /* Expanded arrow (up) */
    .question-box.active button::after {
      transform: translateY(-50%) rotate(-135deg); /* pointing up */
    }

    /* Ensure relative positioning for buttons */
    .suggested-questions button {
      position: relative;
    }
  </style>
</head>
<body>
  <div class="outer-box">
    
    <!-- HEADER -->
    <header id="main-header">
      <h1>Welcome to DaveDoesWater.com!</h1>
      <img src="dropbot-small.png" alt="DropBot Mascot" class="header-logo"/>
    </header>

    <!-- CHAT INPUT (initially above) -->
    <section class="chat-wrapper" id="chat-wrapper">
      <div class="chat-bar">
        <img src="dropbot-small.png" class="input-icon" alt="DropBot"/>
        <input type="text" id="user-input" placeholder="Ask AI Drop Bot!" />
      </div>
      <button id="ask-button" class="send-btn">Ask DropBot</button>
    </section>

    <!-- INTRO TEXT -->
    <section id="intro" class="intro" style="text-align: justify;">
      <p>
        <strong>Meet DropBot ‚Äì your personal AI water expert.</strong>
      </p>
      <p>
        Water is nature‚Äôs universal solvent. As it moves through the earth, it dissolves the minerals it touches. That‚Äôs why your tap water can be completely different from someone‚Äôs just 10 miles away.
      </p>
      <p>
        Here in the Midwest, limestone dominates the soil, so calcium levels above 7 ppm are common and unavoidable. When calcium-rich water flows through copper pipes, corrosion builds up. Heat that same hard water, and you‚Äôll get lime scale ‚Äì a serious threat to appliances.
      </p>
      <p>
        The only scientifically proven way to stop hard water damage? Ion Exchange.
      </p>
      <p>
        Dave Bauer is a water expert with over 15 years of experience solving water challenges for industrial, commercial, and residential clients. The AI DropBot on this page combines more than 100 years of collective water treatment expertise‚Äîready to answer your questions and find the right solution for you.
      </p>
      <p>
        We‚Äôll even come to your home, test your water, and provide answers‚Äîwith no obligation to buy.
      </p>
      <p>
        All Pro Water is the official St. Louis distributor for Hague Water International. We back our systems with a 10-year parts and labor warranty, while Hague offers an industry-leading 25-year manufacturer‚Äôs warranty. Proudly made in the USA, Hague systems are built to protect your home, your appliances, and your health for life.
      </p>
      <p>
        <strong>Call today to schedule your free in-home water evaluation.</strong>
      </p>
    </section>

    <!-- CONTACT INFO -->
    <section id="contact-info" class="contact-info">
      <p><strong>Dave Bauer</strong><br/>
      <a href="tel:3143941500">314-394-1500</a><br/>
      <a href="mailto:Dave@ApwStl.com" class="email-btn">Dave@ApwStl.com</a></p>
    </section>

    <!-- SUGGESTED TOPICS -->
    <section id="suggested-box" class="suggested-questions">
      <!-- Wrap each button and answer in .question-box -->
      <div class="question-box"><button>City Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Spring Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Chlorine</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Well Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Purified Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Soft Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Hard Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Distilled Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Sulfur</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Soft Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Alkaline Water</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Bacteria</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Corrosion</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>UV Treatment</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Pesticides</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Limescale</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Ion Exchange</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>E. Coli</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Soap Scum</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Reverse Osmosis</button><div class="inline-answer" style="display:none;"></div></div>
      <div class="question-box"><button>Heavy Metals</button><div class="inline-answer" style="display:none;"></div></div>
    </section>


    <!-- CHAT WINDOW -->
    <div class="chat-container" id="chat-container">
      <section class="chat-window" id="chat-window" style="display: none;"></section>
    </div>

    <!-- FOOTER -->
    <footer id="footer">
      <div class="footer-logos">
        <img src="allpro-logo.jpg" alt="All Pro Water Logo" />
        <img src="hague-logo.jpg" alt="Hague Water Logo" />
      </div>
      
      <!-- Dave's small photo -->
      <div style="margin-top: 15px; text-align: center;">
        <img src="dave-photo.jpg" alt="Dave Bauer" style="max-width: 120px; border-radius: 8px;" />
      </div>
    
      <div class="footer-contact">
        <p>Dave Bauer ‚Äì 314-394-1500 ‚Äì <a href="mailto:Dave@ApwStl.com">Dave@ApwStl.com</a></p>
      </div>
    </footer>
  </div>

  <!-- Load pre-written answers from external file -->
  <script src="answers.js"></script>

  <!-- SCRIPT -->
  <script>
    const input = document.getElementById("user-input");
    const askBtn = document.getElementById("ask-button");
    const chatWindow = document.getElementById("chat-window");
    const questionBoxes = document.querySelectorAll(".question-box");
    const chatWrapper = document.getElementById("chat-wrapper");
    const chatContainer = document.getElementById("chat-container");

    let hasInteracted = false;
    let thread_id = localStorage.getItem("dropbot_thread_id") || "";

    const scrollToBottom = () => {
      chatWindow.scrollTop = chatWindow.scrollHeight;
    };

    const hideIntro = () => {
      ["main-header", "intro", "contact-info", "suggested-box", "footer"].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = "none";
      });
      chatWindow.style.display = "flex";

      const welcomeMsg = document.createElement("div");
      welcomeMsg.className = "message bot";
      welcomeMsg.innerHTML = "üëã Hi! I‚Äôm DropBot ‚Äî your water knowledge assistant. Ask me anything about water quality, treatment, or solutions!";
      chatWindow.appendChild(welcomeMsg);

      scrollToBottom();
    };

    const moveInputBelowChat = () => {
      chatContainer.style.width = "100%";
      chatContainer.appendChild(chatWrapper);
      document.body.classList.add("chat-layout-active");
    };

    const sendMessage = async () => {
      const query = input.value.trim();
      if (!query) return;

      if (!hasInteracted) {
        hideIntro();
        moveInputBelowChat();
        hasInteracted = true;
      }

      const userMsg = document.createElement("div");
      userMsg.className = "message user";
      userMsg.textContent = query;
      chatWindow.appendChild(userMsg);

      const botMsg = document.createElement("div");
      botMsg.className = "message bot";
      botMsg.innerHTML = "‚è≥ Thinking...";
      chatWindow.appendChild(botMsg);

      scrollToBottom();
      input.value = "";

      try {
        const formData = new FormData();
        formData.append("query", query);
        formData.append("thread_id", thread_id);

        const res = await fetch("https://davedoeswater-drop-bot.hf.space/ask/", {
          method: "POST",
          body: formData
        });

        const data = await res.json();
        thread_id = data.thread_id;
        localStorage.setItem("dropbot_thread_id", thread_id);
        botMsg.innerHTML = marked.parse(data.response || "‚ùå No response.");
      } catch (err) {
        botMsg.innerHTML = "‚ö†Ô∏è Error contacting DropBot.";
      }

      scrollToBottom();
    };

    askBtn.addEventListener("click", sendMessage);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    // Updated suggested question click logic with arrow toggle
    questionBoxes.forEach(box => {
      const btn = box.querySelector("button");
      const answerDiv = box.querySelector(".inline-answer");

      btn.addEventListener("click", () => {
        const isOpen = box.classList.contains("active");

        // Close all boxes first
        questionBoxes.forEach(otherBox => {
          otherBox.classList.remove("active");
          const otherAnswer = otherBox.querySelector(".inline-answer");
          otherAnswer.style.display = "none";
          otherAnswer.textContent = "";
        });

        // If it was not open before, open it
        if (!isOpen) {
          const topic = btn.textContent.trim();
          const answer = answers[topic] || "Sorry, no answer available for this topic yet.";

          answerDiv.textContent = answer;
          answerDiv.style.display = "block";
          box.classList.add("active");
          answerDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      });
    });
  </script>
</body>
</html>
